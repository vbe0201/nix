#!/usr/bin/env bash

# Get each set of users from the git config generated by default.nix.
IDENTITIES=$(git config --global --name-only --get-regexp "user.*..name" | sed -e 's/^user.//' -e 's/.name$//')

# Filter with fzf.
ID=$(echo "${IDENTITIES}" | fzf -e -1 +m -q "$1")
if ! git config --global --get-regexp "user.${ID}.name" > /dev/null; then
  echo "Please use a valid git identity.
Options:"
  git config --global --name-only --get-regexp "user.*..name" | sed -e 's/^user.//' -e 's/.name$//' -e 's/^/\t/'
  exit 1
fi

git config user.name "$(git config user.${ID}.name)"
git config user.email "$(git config user.${ID}.email)"
if [[ $(git config user.${ID}.signingKey) ]]; then
  git config user.signingkey "$(git config user.${ID}.signingKey)"
else
  git config commit.gpgsign false
fi
